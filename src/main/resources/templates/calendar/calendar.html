<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/main.min.js'></script>
    <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js'></script>
    <link rel="stylesheet" th:href="@{/css/reset.css}">
    <link rel="stylesheet" th:href="@{/css/calendar/calendar.css}">

    <!-- <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.css" rel="stylesheet" /> -->


    <title>Document</title>


</head>
<body>

<div th:replace="~{include/header :: headerFragment}"></div>



    <div id="mobileCalendarButton" >
        <div>
            <button type="button" id="mobileOpenJobPosting">ê³µì±„ì •ë³´</button>
            <button type="button" id="mobileJobPosting">ì±„ìš©ì •ë³´</button>
            <button type="button" id="mobileStartDate">ì‹œì‘ì¼</button>
            <button type="button" id="mobileEndDate">ì¢…ë£Œì¼</button>
        </div>
    </div>

    <div id='external-events'>
    <!--
        <p>
            <strong>Draggable Events</strong>
        </p>

        <div class='fc-event fc-h-event fc-daygrid-event fc-daygrid-block-event'>
            <div class='fc-event-main'>My Event 1</div>
        </div>
        <div class='fc-event fc-h-event fc-daygrid-event fc-daygrid-block-event'>
            <div class='fc-event-main'>My Event 2</div>
        </div>
        <div class='fc-event fc-h-event fc-daygrid-event fc-daygrid-block-event'>
            <div class='fc-event-main'>My Event 3</div>
        </div>
        <div class='fc-event fc-h-event fc-daygrid-event fc-daygrid-block-event'>
            <div class='fc-event-main'>My Event 4</div>
        </div>
        <div class='fc-event fc-h-event fc-daygrid-event fc-daygrid-block-event'>
            <div class='fc-event-main'>My Event 5</div>
        </div>

        <p>
            <input type='checkbox' id='drop-remove' />
            <label for='drop-remove'>remove after drop</label>
        </p>
        </div>

        <div id='calendar-container'>

        -->
    </div>


    <div id="titleToolTip"></div>
    <div id='calendar'></div>



    <script th:src="@{/css/js/calendar.js}"></script>
    <script>

    document.addEventListener('DOMContentLoaded', function() {

        //ë””ë²„ê¹…
        $.ajax({
            url: '/calendar/events',  // ì„œë²„ì—ì„œ ì´ë²¤íŠ¸ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” URL
            type: 'GET',
            success: function(data) {
                console.log("Received events:", data);  // ì—¬ê¸°ì— ë°ì´í„° í™•ì¸ ë¡œê·¸ ì¶”ê°€
                // ë°ì´í„°ë¥¼ ë°›ì•„ì˜¤ë©´, ì´ë¥¼ í™”ë©´ì— í‘œì‹œí•˜ëŠ” í•¨ìˆ˜ í˜¸ì¶œ
                renderCalendarEvents(data);  // ë°›ì€ ë°ì´í„°ë¥¼ render í•¨ìˆ˜ë¡œ ì „ë‹¬
            },
            error: function(error) {
                console.error("Error fetching events:", error);  // ì˜¤ë¥˜ê°€ ë°œìƒí•˜ë©´ ì½˜ì†”ì— ë¡œê·¸ ì¶œë ¥
            }
        });




    var Calendar = FullCalendar.Calendar;
    var Draggable = FullCalendar.Draggable;

    var containerEl = document.getElementById('external-events');
    var calendarEl = document.getElementById('calendar');
    var tooltip = document.getElementById('titleToolTip');

    // initialize the external events
    // -----------------------------------------------------------------

    new Draggable(containerEl, {
        itemSelector: '.fc-event',
        eventData: function(eventEl) {
        return {
            title: eventEl.innerText
        };
        }
    });

    // initialize the calendar11
    // -----------------------------------------------------------------

        var customButtons = {
            startDay: {
                text: 'ì‹œì‘ì¼',
                className: 'startDay',
                click: function() {
                    ButtonClick('startDay');

                }
            },
            endDay: {
                text: 'ì¢…ë£Œì¼',
                className: 'endDay',
                click: function() {
                    ButtonClick('endDay');
                }
            },
            openJobPosting: {
                text: 'ê³µì±„ì •ë³´',
                className: 'openJobPosting',
                click: function() {
                    ButtonClick('openJobPosting');
                }
            },
            jobPosting: {
                text: 'ì±„ìš©ì •ë³´',
                className: 'jobPosting',
                click: function() {
                    ButtonClick('jobPosting');
                }
            }
        };

    function ButtonClick(e) {
        var buttonClasses = ['fc-startDay-button','fc-endDay-button','fc-openJobPosting-button','fc-jobPosting-button'];
        for(var i = 0; i< buttonClasses.length; i++) {
            var btn = document.querySelector('.' + buttonClasses[i]);
            if(btn) {
                if(buttonClasses[i] === 'fc-' + e + '-button') {
                    btn.classList.add('bottomline');
                } else {
                    btn.classList.remove('bottomline');
                }
            }
        }
    }



    var calendar = new Calendar(calendarEl, {
        locale: 'ko',
        headerToolbar: {
            left: window.innerWidth < 767 ? '' : 'openJobPosting,jobPosting,startDay,endDay',
            center: 'prev,title,next',
            right: 'today'
        },
        initialView: 'dayGridMonth',
        customButtons: customButtons,
        dayCellContent : function(arg) {
            return arg.date.getDate();
        },

        events:'/calendar/events',


        dayMaxEvents: true, // ë˜ëŠ” ìˆ«ìë¡œ: dayMaxEvents: 3 //ì¹¸ ì´ìƒì€ + ì²˜ë¦¬

        //ì¼ì • ìŠ¤íƒ€ì¼
        eventDidMount: function(info) {
            var mainEl = info.el.querySelector('.fc-event-main');
            if (mainEl) {
                mainEl.setAttribute('title', info.event.title);
                mainEl.style.color='#000'
                mainEl.style.backgroundColor = '#fff';
                mainEl.style.marginTop='3px';
                mainEl.style.border='none';


                //ì¦ì°¾ê³¼ ì œëª© í•œì¤„ì •ë ¬
                mainEl.style.display = 'flex';
                mainEl.style.alignItems = 'center';
                mainEl.style.justifyContent = 'space-between';

                //ê·¸ëƒ¥ í•˜ë©´ ì•ˆë˜ë‹ˆê¹Œ ì œëª© ë¶€ë¶„ì„ spanìœ¼ë¡œ ê°ì‹¸ì„œ between ë¨¹ê²Œ
                var titleSpan = document.createElement('span');
                titleSpan.textContent = info.event.title;
                titleSpan.style.flex = '1';
                titleSpan.style.overflow = 'hidden';
                titleSpan.style.textOverflow = 'ellipsis';
                titleSpan.style.whiteSpace = 'nowrap';
                titleSpan.classList.add('titleSpan');

                //í…ìŠ¤íŠ¸ ì§‘ì–´ë„£ê¸°
                mainEl.innerHTML = '';
                mainEl.appendChild(titleSpan);


                titleSpan.addEventListener('mouseenter', function() {

                    var rect = titleSpan.getBoundingClientRect();

                    tooltip.innerHTML = info.event.title;
                    tooltip.style.position = 'absolute';
                    tooltip.style.zIndex = '9999' ;
                    tooltip.style.top = (rect.top + window.scrollY - 150) + 'px';
                    tooltip.style.left = (rect.left + window.scrollX) + 'px';
                    tooltip.style.minWidth = rect.width + 'px';
                    tooltip.style.backgroundColor = '#e4e4e4';
                    tooltip.style.color='#000';

                    tooltip.style.display = 'block';

                    titleSpan.style.cursor = 'pointer'


                });

                titleSpan.addEventListener('mouseleave', function () {
                    tooltip.style.display = 'none';

                    info.el.style.cursor = 'default';
                });

                titleSpan.addEventListener('click', function () {
                    var homepgDetail = info.event.extendedProps.empWantedHomepgDetail;

                    if(homepgDetail) {
                        window.location.href = homepgDetail;
                    } else {
                        alert('í˜„ì¬ í•´ë‹¹ ê³µê³ ì˜ ìƒì„¸í˜ì´ì§€ë¡œ ì ‘ê·¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤!');
                    }
                })

            }




            // var morePopover = document.querySelector('.fc-popover');
            //
            // if(morePopover) {
            //     morePopover.addEventListener('mouseenter', function(e) {
            //         if(e.target && e.target.classList.contains('fc-event-main')) {
            //             var el = info.el;
            //             var rect = el.getBoundingClientRect();
            //
            //             tooltip.innerHTML = title;
            //             tooltip.style.position = 'absolute';
            //             tooltip.style.zIndex = '9999' ;
            //             tooltip.style.top = (rect.top + window.scrollY - 150) + 'px';
            //             tooltip.style.left = (rect.left + window.scrollX) + 'px';
            //             tooltip.style.minWidth = rect.width + 'px';
            //             tooltip.style.backgroundColor = '#e4e4e4';
            //             tooltip.style.color='#000';
            //             tooltip.style.paddingLeft = '5px';
            //             tooltip.style.paddingRigth = '10px';
            //             tooltip.style.borderRadius = '5px';
            //             tooltip.style.fontSize = '16px';
            //             tooltip.style.whiteSpace = 'normal';
            //             tooltip.style.wordBreak = 'break-word';
            //             tooltip.style.display = 'block';
            //
            //             el.style.cursor = 'pointer'
            //         }
            //
            //     })
            //
            //     morePopover.addEventListener('mouseleave', function(e) {
            //         if(e.target && e.target.classList.contains('fc-event-main')) {
            //
            //             tooltip.style.display = 'none';
            //
            //             info.el.style.cursor = 'default';
            //
            //         }
            //     })
            //
            //     morePopover.addEventListener('click', function(e) {
            //         if(e.target && e.target.classList.contains('fc-event-main')) {
            //
            //
            //
            //         }
            //
            //
            //
            //     })
            //
            // }


            // â­ ì¦ê²¨ì°¾ê¸° í•˜íŠ¸ ì¶”ê°€ ì‹œì‘
            var heart = document.createElement('span');
            heart.innerHTML = 'ğŸ¤'; // ì´ˆê¸° ìƒíƒœ: ë¹ˆ í•˜íŠ¸
            heart.style.marginLeft = '8px';
            heart.style.cursor = 'pointer';
            heart.setAttribute('data-favorited', 'false');

            heart.addEventListener('click', function(e) {
                e.stopPropagation(); // ìƒì„¸ í˜ì´ì§€ ì´ë™ ë§‰ê¸°

                var isFav = heart.getAttribute('data-favorited') === 'true';
                var empSeqNo = Number(info.event.extendedProps.empSeqNo);
                var userId = sessionStorage.getItem( 'userId' );


                if (isFav) {
                    heart.innerHTML = 'ğŸ¤';
                    heart.setAttribute('data-favorited', 'false');

                    console.log(empSeqNo);
                    console.log("userId:", sessionStorage.getItem('userId'));

                    var xhr = new XMLHttpRequest();
                    xhr.open("post", "/calendar/favorite/remove", true);
                    xhr.setRequestHeader("Content-Type", "application/json;charset=UTF-8");

                    //ë””ë²„ê¹…ìš©
                    console.log(JSON.stringify({
                        empSeqNo: empSeqNo,
                        userId: sessionStorage.getItem('userId')
                    }))

                    try {
                        let payload = JSON.stringify({
                            empSeqNo: empSeqNo,
                            userId: userId
                        });
                        console.log("ğŸ”¥ JSON payload", payload);
                    } catch (err) {
                        console.error("âŒ JSON.stringify ì˜¤ë¥˜:", err);
                    }




                    xhr.send(JSON.stringify({
                        empSeqNo: empSeqNo,
                        userId: sessionStorage.getItem('userId')
                    }))


                } else {
                    heart.innerHTML = 'â¤ï¸';
                    heart.setAttribute('data-favorited', 'true');

                    console.log(empSeqNo);
                    sessionStorage.getItem( 'userId' )

                    var xhr = new XMLHttpRequest();
                    xhr.open("post", "/calendar/favorite/add", true);
                    xhr.setRequestHeader("Content-Type", "application/json;charset=UTF-8");

                    //ë””ë²„ê¹…ìš©
                    console.log(JSON.stringify({
                        empSeqNo: empSeqNo,
                        userId: sessionStorage.getItem('userId')
                    }))

                    try {
                        let payload = JSON.stringify({
                            empSeqNo: empSeqNo,
                            userId: userId
                        });
                        console.log("ğŸ”¥ JSON payload", payload);
                    } catch (err) {
                        console.error("âŒ JSON.stringify ì˜¤ë¥˜:", err);
                    }




                    xhr.send(JSON.stringify({
                        empSeqNo: empSeqNo,
                        userId: sessionStorage.getItem('userId')
                    }))

                }

                // ì„œë²„ë¡œ ì¦ê²¨ì°¾ê¸° ìƒíƒœ ì €ì¥í•˜ê³  ì‹¶ìœ¼ë©´ ì—¬ê¸°ì— Ajax ìš”ì²­ ì‘ì„±
                /*
                var xhr = new XMLHttpRequest();
                xhr.open("POST", "/calendar/favorite", true);
                xhr.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
                xhr.send(JSON.stringify({
                    id: info.event.id,
                    favorite: !isFav
                }));
                */
            });

            var eventMain = info.el.querySelector('.fc-event-main');
            if (eventMain) {
                eventMain.appendChild(heart);
            }
            // â­ ì¦ê²¨ì°¾ê¸° í•˜íŠ¸ ì¶”ê°€ ë





        },


        // //í’€ìº˜ë¦°ë” í˜¸ë²„ ì—­í•  í•˜ëŠ” event - mouseenter
        //
        // eventMouseEnter: function(info) {
        //     var titleSpan = document.querySelector('.titleSpan');
        //     var el = info.el;
        //     var title = info.event.title;
        //
        //     // ìœ„ì¹˜ ê³„ì‚°
        //     var rect = el.getBoundingClientRect();
        //
        //     tooltip.innerHTML = title;
        //     tooltip.style.position = 'absolute';
        //     // tooltip.style.zIndex = '9999' ;
        //     tooltip.style.top = (rect.top + window.scrollY - 150) + 'px';
        //     tooltip.style.left = (rect.left + window.scrollX) + 'px';
        //     tooltip.style.minWidth = rect.width + 'px';
        //     tooltip.style.backgroundColor = '#e4e4e4';
        //     tooltip.style.color='#000';
        //
        //     tooltip.style.display = 'block';
        //
        //     el.style.cursor = 'pointer'
        // },
        //
        // eventMouseLeave: function(info) {
        //
        //     tooltip.style.display = 'none';
        //
        //     info.el.style.cursor = 'default';
        // },
        //
        // eventClick: function(info) {
        //     var homepgDetail = info.event.extendedProps.empWantedHomepgDetail;
        //
        //     if(homepgDetail) {
        //         window.location.href = homepgDetail;
        //     } else {
        //         alert('í˜„ì¬ í•´ë‹¹ ê³µê³ ì˜ ìƒì„¸í˜ì´ì§€ë¡œ ì ‘ê·¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤!');
        //     }
        //
        // },



        // dateClick: function(info) {
        // var date = info.date; //ì„ íƒí•œ ë‚ ì§œë¥¼ dateì— ë„£ì–´ì„œ ë‚ ì§œ êµ¬í•˜ëŠ” ê±°
        // var year = date.getFullYear();
        // var month = date.getMonth() + 1;
        // var day = date.getDate();
        //
        // //ë‚ ì§œ ì •ëˆì‹œì¼œì„œ ë‘ìë¦¿ìˆ˜ë¡œ
        // if(month < 10) month = '0' + month;
        // if(day < 10) day = '0' + day;
        //
        // //í•œê¸€ë¡œ
        // var clickDateIndicate = year + 'ë…„ ' + month + 'ì›” ' + day + 'ì¼';
        //
        // //div ì— í‘œì‹œí•˜ê¸°
        // document.querySelector('.selectDate').textContent=clickDateIndicate;
        //
        // // ì´ì „ ì„ íƒëœ ì…€ì—ì„œ ìƒ‰ ì œê±°
        // document.querySelectorAll('.fc-daygrid-day').forEach(function(cell) {
        //     cell.classList.remove('selectedDateColor');
        // });
        //
        // // í´ë¦­í•œ ë‚ ì§œ ì…€ì— ìƒ‰ ì…íˆê¸°
        // var clickedCell = document.querySelector('[data-date="' + info.dateStr + '"]');
        // if (clickedCell) {
        //     clickedCell.classList.add('selectedDateColor');
        //     }
        // },

    });

    calendar.render();
    });


    /*
    * í˜„ì¬ëŠ” window.innerWidthë¡œ ì´ˆê¸°ê°’ë§Œ ì¡ê³  ìˆê¸° ë•Œë¬¸ì— í™”ë©´ í¬ê¸° ë³€ê²½ ì‹œ ë²„íŠ¼ ì—…ë°ì´íŠ¸ ì•ˆ ë¨.
ì´ê±¸ ë™ì ìœ¼ë¡œ ë°”ê¾¸ê³  ì‹¶ë‹¤ë©´ window.resize ì´ë²¤íŠ¸ì— calendar.setOption()ì´ë‚˜ calendar.destroy() â†’ new Calendar() ë°©ì‹ ì¨ì•¼ í•´.

í•˜ì§€ë§Œ ì§€ê¸ˆì€ ê·¸ê²Œ ëª©ì  ì•„ë‹ˆë‹ˆê¹Œ ìœ„ ì½”ë“œë§Œ ìˆ˜ì •í•˜ë©´ PCì—ì„œ ë²„íŠ¼ ë¬¸ì œ í•´ê²°ë¼!

í•„ìš”í•˜ë©´ resize ì²˜ë¦¬ë„ ê°™ì´ ë„ì™€ì¤„ê²Œ
    *
    *
    * */


    </script>


<script th:src="@{/css/js/header.js}"></script>

<!--
<div class="selectDate"></div>

<div class="blankBox">

    <div class="calendarJobPost ">
        ì•…ë•ê¸°ì—…
        <div>ì£¼5ì¼ 120ì‹œê°„ ì—°ë´‰ 1200ë§Œì› í”„ë¡œê·¸ë˜ë¨¸</div>
    </div>
    <div class="calendarJobPost">
        ì•…ë•ê¸°ì—…
        <div>ì£¼5ì¼ 120ì‹œê°„ ì—°ë´‰ 1200ë§Œì› í”„ë¡œê·¸ë˜ë¨¸</div>
    </div>
    <div class="calendarJobPost">
        ì•…ë•ê¸°ì—…
    <div>ì£¼5ì¼ 120ì‹œê°„ ì—°ë´‰ 1200ë§Œì› í”„ë¡œê·¸ë˜ë¨¸</div>
    </div>
    <div class="calendarJobPost">
        ì•…ë•ê¸°ì—…
        <div>ì£¼5ì¼ 120ì‹œê°„ ì—°ë´‰ 1200ë§Œì› í”„ë¡œê·¸ë˜ë¨¸</div>
    </div>
    <div class="calendarJobPost">
        ì•…ë•ê¸°ì—…
        <div>ì£¼5ì¼ 120ì‹œê°„ ì—°ë´‰ 1200ë§Œì› í”„ë¡œê·¸ë˜ë¨¸</div>
    </div>
    <div class="calendarJobPost">
        ì•…ë•ê¸°ì—…
        <div>ì£¼5ì¼ 120ì‹œê°„ ì—°ë´‰ 1200ë§Œì› í”„ë¡œê·¸ë˜ë¨¸</div>
    </div>
    <div class="calendarJobPost">
        ì•…ë•ê¸°ì—…
        <div>ì£¼5ì¼ 120ì‹œê°„ ì—°ë´‰ 1200ë§Œì› í”„ë¡œê·¸ë˜ë¨¸</div>
    </div>

</div>
-->

<div class="goPostingPageBox">
    <button type="button" id="goPostingPage">ìƒì„¸ê²€ìƒ‰</button>
</div>

<script>

    document.addEventListener("DOMContentLoaded", function () {
        const goPostingPage = document.getElementById('goPostingPage');
        goPostingPage.addEventListener('click', function () {
            event.preventDefault();
            location.href = "/jobposting";
        });
    });

</script>


<div th:replace="~{include/footer :: footerFragment}"></div>

</body>
</html>
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>íšŒì›ê°€ì…</title>
  <link rel="stylesheet" href="../css/user/regiest.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
</head>
<body>
<div th:replace="include/header :: headerFragment"></div>

<div class="wrap">
  <div class="form-container">
    <h2 class="title">WORKLET</h2>
    <h2>íšŒì›ê°€ì…</h2>
    <form action="/user/regist" method="post" name="registForm">
      <div class="form">
        <div class="form-row">
          <label class="username">ì•„ì´ë””</label>
          <input type="text" name="userId" id="id" placeholder="6~20ì ì˜ë¬¸ì ë˜ëŠ” ìˆ«ì">

          <span id="check-result"></span>

        </div>

        <div class="form-row">
          <label for="password">ë¹„ë°€ë²ˆí˜¸</label>
          <input type="password" name="userPw" id="password" placeholder="8~16ì ì˜ë¬¸, ìˆ«ì, íŠ¹ìˆ˜ë¬¸ì í¬í•¨">
        </div>

        <div class="form-row">
          <label for="passwordCheck">ë¹„ë°€ë²ˆí˜¸ í™•ì¸</label>
          <input type="password" id="passwordCheck" placeholder="ë¹„ë°€ë²ˆí˜¸ ì¬ì…ë ¥">
        </div>

        <div class="form-row">
          <label>ì´ë¦„</label>
          <input type="text" id="name" name="userName">
        </div>

        <div class="form-row">
          <label>ì„±ë³„</label>
          <div class="radio-group">
            <label><input type="radio" name="userGender" value="ë‚¨ì„±"> ë‚¨ì„±</label>
            <label><input type="radio" name="userGender" value="ì—¬ì„±"> ì—¬ì„±</label>
          </div>
        </div>

        <div class="form-row">
          <label>ìƒë…„ì›”ì¼</label>
          <div class="birth-row">
            <input type="text" class="small" id="birthYear" placeholder="ë…„">
            <input type="text" class="small" id="birthMonth" placeholder="ì›”">
            <input type="text" class="small" id="birthDay" placeholder="ì¼">
            <input type="hidden" name="userBirthday" id="userBirthday">
          </div>
        </div>

        <div class="form-row">
          <label>ì—°ë½ì²˜</label>
          <input type="text" placeholder="000-0000-0000" name="userPhone">
        </div>

        <div class="form-row">
          <label>ì´ë©”ì¼</label>
          <input type="email" placeholder="example@email.com" name="userEmail">
        </div>

        <div class="form-row">
          <label>í¬ë§ê³ ìš©í˜•íƒœ (ìµœëŒ€ 3ê°œ)</label>
          <div class="option-group">
            <label><input type="checkbox" name="wantJobType" value="ì •ê·œì§"> ì •ê·œì§</label>
            <label><input type="checkbox" name="wantJobType" value="ê³„ì•½ì§"> ê³„ì•½ì§</label>
            <label><input type="checkbox" name="wantJobType" value="ì¸í„´"> ì¸í„´</label>
            <label><input type="checkbox" name="wantJobType" value="ì•„ë¥´ë°”ì´íŠ¸"> ì•„ë¥´ë°”ì´íŠ¸</label>
          </div>
        </div>

        <div class="form-row">
          <label>í¬ë§ì§ì¢…ê²½ë ¥</label>
          <div class="option-group">
            <label><input type="radio" name="wantJobWorkexpHowlong" value="0"> ì—†ìŒ</label>
            <label><input type="radio" name="wantJobWorkexpHowlong" value="1"> 1ë…„ ì´í•˜</label>
            <label><input type="radio" name="wantJobWorkexpHowlong" value="2"> 1ë…„~2ë…„</label>
            <label><input type="radio" name="wantJobWorkexpHowlong" value="3"> 2ë…„ ì´ìƒ</label>
          </div>
        </div>

        <div class="form-group terms-box">
          <label class="terms-title">ê°€ì… ì•½ê´€</label>
          <div class="terms-inner-box">
            <div class="terms-item">
              <label><input type="checkbox" class="agree" required> ê°œì¸íšŒì› ì•½ê´€ ë™ì˜(í•„ìˆ˜)</label>
            </div>
            <div class="terms-item">
              <label><input type="checkbox" class="agree" required> ê°œì¸ì •ë³´ ìˆ˜ì§‘ ë° ì´ìš© ë™ì˜(í•„ìˆ˜)</label>
            </div>
            <div class="terms-item">
              <label><input type="checkbox" class="agree"> ë§ˆì¼€íŒ… ì •ë³´ ìˆ˜ì‹  ë™ì˜ - ì´ë©”ì¼(ì„ íƒ)</label>
            </div>
            <div class="terms-item">
              <label><input type="checkbox" class="agree"> ë§ˆì¼€íŒ… ì •ë³´ ìˆ˜ì‹  ë™ì˜ - MMS(ì„ íƒ)</label>
            </div>
          </div>
          <div class="terms-all">
            <label><input type="checkbox" id="checkAll"> <strong>ì „ì²´ ë™ì˜</strong></label>
            <p class="terms-desc">ìœ„ì˜ ì•½ê´€ì— ëª¨ë‘ ë™ì˜í•©ë‹ˆë‹¤.</p>
          </div>
        </div>

        <button type="submit" class="submit-btn">íšŒì› ê°€ì…í•˜ê¸°</button>
      </div>
    </form>
  </div>
</div>

<script>
  document.getElementById("checkAll").addEventListener("change", function () {
    document.querySelectorAll(".agree").forEach(chk => chk.checked = this.checked);
  });

  document.querySelectorAll(".agree").forEach(chk => {
    chk.addEventListener("change", function () {
      const allChecked = Array.from(document.querySelectorAll(".agree")).every(cb => cb.checked);
      document.getElementById("checkAll").checked = allChecked;
    });
  });

  document.querySelector(".submit-btn").addEventListener("click", function (e) {
    e.preventDefault();

    const id = document.getElementById("id");
    const pw = document.getElementById("password");
    const pwCheck = document.getElementById("passwordCheck");
    const name = document.getElementById("name");
    const gender = document.querySelector('input[name="userGender"]:checked');
    const birthYear = document.getElementById("birthYear").value.trim();
    const birthMonth = document.getElementById("birthMonth").value.trim();
    const birthDay = document.getElementById("birthDay").value.trim();
    const userBirthday = document.getElementById("userBirthday");

    const phone = document.querySelector('input[name="userPhone"]');
    const email = document.querySelector('input[name="userEmail"]');
    const employmentTypes = document.querySelectorAll('.option-group input[type="checkbox"]');
    const career = document.querySelector('input[name="wantJobWorkexpHowlong"]:checked');

    const redId = /^[a-z]+[a-z0-9]{5,19}$/g;
    const redPw = /^(?=.*[a-zA-Z])(?=.*\d)(?=.*[~!@#$%^&*()_+]).{8,16}$/;
    const phoneRegex = /^\d{3}-\d{3,4}-\d{4}$/;
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

    if (!id.value || !redId.test(id.value)) return alert("ì˜¬ë°”ë¥¸ ì•„ì´ë””ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”");
    if (!pw.value || !redPw.test(pw.value)) return alert("ì˜¬ë°”ë¥¸ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”");
    if (pw.value !== pwCheck.value) return alert("ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤");
    if (!name.value) return alert("ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”");
    if (!gender) return alert("ì„±ë³„ì„ ì„ íƒí•´ì£¼ì„¸ìš”");

    if (!/^\d{4}$/.test(birthYear) || birthYear < 1900) return alert("ì¶œìƒë…„ë„ë¥¼ ì˜¬ë°”ë¥´ê²Œ ì…ë ¥í•´ì£¼ì„¸ìš”");
    if (birthMonth < 1 || birthMonth > 12) return alert("ì›”ì€ 1~12 ì‚¬ì´ì—¬ì•¼ í•©ë‹ˆë‹¤");
    if (birthDay < 1 || birthDay > 31) return alert("ì¼ì€ 1~31 ì‚¬ì´ì—¬ì•¼ í•©ë‹ˆë‹¤");
    const maxDay = new Date(birthYear, birthMonth, 0).getDate();
    if (birthDay > maxDay) return alert(`${birthMonth}ì›”ì€ ${maxDay}ì¼ê¹Œì§€ ìˆìŠµë‹ˆë‹¤`);
    userBirthday.value = `${birthYear}-${birthMonth.padStart(2, '0')}-${birthDay.padStart(2, '0')}`;

    if (!phoneRegex.test(phone.value)) return alert("ì „í™”ë²ˆí˜¸ í˜•ì‹ì„ í™•ì¸í•´ì£¼ì„¸ìš” (ì˜ˆ: 010-1234-5678)");
    if (!emailRegex.test(email.value)) return alert("ì´ë©”ì¼ í˜•ì‹ì„ í™•ì¸í•´ì£¼ì„¸ìš”");

    const checkedEmployment = Array.from(employmentTypes).filter(cb => cb.checked);
    if (checkedEmployment.length === 0 || checkedEmployment.length > 3) return alert("ê³ ìš©í˜•íƒœëŠ” 1~3ê°œ ì„ íƒí•´ì£¼ì„¸ìš”");
    if (!career) return alert("ê²½ë ¥ì„ ì„ íƒí•´ì£¼ì„¸ìš”");

    alert("íšŒì›ê°€ì…ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤! ğŸ‰");
    document.forms["registForm"].submit();
  });




    const userIdInput = document.getElementById('id');
    const resultSpan = document.getElementById('check-result');

    userIdInput.addEventListener('input', function () {
      const userId = userIdInput.value;

      // ì…ë ¥ ì•ˆ í–ˆìœ¼ë©´ ë¦¬ì…‹
      if (userId.trim() === '') {
        resultSpan.textContent = '';
        resultSpan.style.color = '';
        return;
      }

      fetch(`/user/check-id?userId=${encodeURIComponent(userId)}`)
              .then(response => response.text())
              .then(data => {
                console.log('ì„œë²„ ì‘ë‹µ:', data);

                if (data === 'duplicate') {
                  resultSpan.textContent = 'ì‚¬ìš© ì¤‘ì¸ ì•„ì´ë””ì…ë‹ˆë‹¤.';
                  resultSpan.style.color = 'red';
                } else if (data === 'available') {
                  resultSpan.textContent = 'ì‚¬ìš© ê°€ëŠ¥í•œ ì•„ì´ë””ì…ë‹ˆë‹¤.';
                  resultSpan.style.color = 'green';
                } else {
                  resultSpan.textContent = 'ì•Œ ìˆ˜ ì—†ëŠ” ì‘ë‹µì…ë‹ˆë‹¤.';
                  resultSpan.style.color = 'gray';
                }
              })
              .catch(error => {
                console.error('ì—ëŸ¬ ë°œìƒ:', error);
                resultSpan.textContent = 'ì„œë²„ ì˜¤ë¥˜ì…ë‹ˆë‹¤.';
                resultSpan.style.color = 'orange';
              });
    });



</script>

<div th:replace="include/footer :: footerFragment"></div>

<script src="../css/js/header.js"></script>
</body>
</html>
